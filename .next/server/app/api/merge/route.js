"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/merge/route";
exports.ids = ["app/api/merge/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "sharp":
/*!************************!*\
  !*** external "sharp" ***!
  \************************/
/***/ ((module) => {

module.exports = require("sharp");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmerge%2Froute&page=%2Fapi%2Fmerge%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmerge%2Froute.ts&appDir=D%3A%5CCursor%5Cface2exchange%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CCursor%5Cface2exchange&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmerge%2Froute&page=%2Fapi%2Fmerge%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmerge%2Froute.ts&appDir=D%3A%5CCursor%5Cface2exchange%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CCursor%5Cface2exchange&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_node_polyfill_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/node-polyfill-headers */ \"(rsc)/./node_modules/next/dist/server/node-polyfill-headers.js\");\n/* harmony import */ var next_dist_server_node_polyfill_headers__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_node_polyfill_headers__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var D_Cursor_face2exchange_app_api_merge_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/merge/route.ts */ \"(rsc)/./app/api/merge/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_1__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_2__.RouteKind.APP_ROUTE,\n        page: \"/api/merge/route\",\n        pathname: \"/api/merge\",\n        filename: \"route\",\n        bundlePath: \"app/api/merge/route\"\n    },\n    resolvedPagePath: \"D:\\\\Cursor\\\\face2exchange\\\\app\\\\api\\\\merge\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_Cursor_face2exchange_app_api_merge_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/merge/route\";\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZtZXJnZSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGbWVyZ2UlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZtZXJnZSUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDQ3Vyc29yJTVDZmFjZTJleGNoYW5nZSU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9RCUzQSU1Q0N1cnNvciU1Q2ZhY2UyZXhjaGFuZ2UmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQWdEO0FBQ3NEO0FBQ3ZDO0FBQ2tCO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsdUdBQXVHO0FBQy9HO0FBQ2lKOztBQUVqSiIsInNvdXJjZXMiOlsid2VicGFjazovL2ZhY2Utc3dhcC1hcHAvPzQ4ZmYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFwibmV4dC9kaXN0L3NlcnZlci9ub2RlLXBvbHlmaWxsLWhlYWRlcnNcIjtcbmltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkQ6XFxcXEN1cnNvclxcXFxmYWNlMmV4Y2hhbmdlXFxcXGFwcFxcXFxhcGlcXFxcbWVyZ2VcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwic3RhbmRhbG9uZVwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9tZXJnZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL21lcmdlXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9tZXJnZS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkQ6XFxcXEN1cnNvclxcXFxmYWNlMmV4Y2hhbmdlXFxcXGFwcFxcXFxhcGlcXFxcbWVyZ2VcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0IH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvbWVyZ2Uvcm91dGVcIjtcbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmerge%2Froute&page=%2Fapi%2Fmerge%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmerge%2Froute.ts&appDir=D%3A%5CCursor%5Cface2exchange%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CCursor%5Cface2exchange&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/merge/route.ts":
/*!********************************!*\
  !*** ./app/api/merge/route.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var sharp__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! sharp */ \"sharp\");\n/* harmony import */ var sharp__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(sharp__WEBPACK_IMPORTED_MODULE_1__);\n\n\nasync function compressImage(file) {\n    try {\n        const buffer = await file.arrayBuffer();\n        const fileBuffer = Buffer.from(buffer);\n        const randomQuality = 0.59 + Math.random() * (0.99 - 0.59);\n        const finalQuality = Math.floor(80 * randomQuality);\n        console.log(\"压缩质量系数:\", randomQuality.toFixed(6));\n        console.log(\"最终压缩质量:\", finalQuality);\n        const compressedBuffer = await sharp__WEBPACK_IMPORTED_MODULE_1___default()(fileBuffer).resize(1920, 1920, {\n            fit: \"inside\",\n            withoutEnlargement: true\n        }).jpeg({\n            quality: finalQuality,\n            progressive: true\n        }).toBuffer();\n        const compressedFile = new File([\n            compressedBuffer\n        ], file.name, {\n            type: \"image/jpeg\"\n        });\n        console.log(\"压缩前大小:\", (file.size / 1024 / 1024).toFixed(2) + \"MB\");\n        console.log(\"压缩后大小:\", (compressedFile.size / 1024 / 1024).toFixed(2) + \"MB\");\n        return compressedFile;\n    } catch (error) {\n        console.error(\"图片压缩失败:\", error);\n        return file;\n    }\n}\nasync function uploadToImageHub(file, retryCount = 0) {\n    try {\n        const formData = new FormData();\n        formData.append(\"source\", file);\n        console.log(\"准备上传图片到图床:\", {\n            url: process.env.IMAGEHUB_API_URL,\n            method: \"POST\",\n            file: {\n                type: file.type,\n                size: `${(file.size / 1024 / 1024).toFixed(2)}MB`,\n                lastModified: file instanceof File ? new Date(file.lastModified).toISOString() : \"N/A\",\n                name: file instanceof File ? file.name : \"blob\"\n            },\n            retryCount\n        });\n        const requestHeaders = {\n            \"X-API-Key\": \"***\" + process.env.IMAGEHUB_API_KEY.slice(-6)\n        };\n        console.log(\"请求头:\", requestHeaders);\n        console.log(\"FormData 内容:\");\n        for (const [key, value] of formData.entries()){\n            console.log(\"- \", key, \":\", {\n                type: value instanceof Blob ? value.type : typeof value,\n                size: value instanceof Blob ? `${(value.size / 1024 / 1024).toFixed(2)}MB` : \"N/A\",\n                name: value instanceof File ? value.name : \"blob\"\n            });\n        }\n        const startTime = Date.now();\n        const response = await fetch(process.env.IMAGEHUB_API_URL, {\n            method: \"POST\",\n            headers: {\n                \"X-API-Key\": process.env.IMAGEHUB_API_KEY\n            },\n            body: formData\n        });\n        const endTime = Date.now();\n        console.log(\"图床响应详情:\", {\n            timing: {\n                startTime: new Date(startTime).toISOString(),\n                endTime: new Date(endTime).toISOString(),\n                duration: `${endTime - startTime}ms`\n            },\n            status: {\n                code: response.status,\n                text: response.statusText\n            },\n            headers: Object.fromEntries(response.headers.entries()),\n            type: response.type,\n            url: response.url,\n            redirected: response.redirected\n        });\n        if (!response.ok) {\n            const errorText = await response.text();\n            console.error(\"图床上传失败:\", {\n                status: response.status,\n                statusText: response.statusText,\n                responseBody: errorText,\n                timestamp: new Date().toISOString()\n            });\n            throw new Error(\"图片上传失败\");\n        }\n        const result = await response.json();\n        console.log(\"图床上传成功:\", {\n            timing: {\n                total: `${endTime - startTime}ms`,\n                timestamp: new Date().toISOString()\n            },\n            response: {\n                status_code: result.status_code,\n                status_txt: result.status_txt,\n                image: result.image\n            },\n            request: {\n                originalFile: {\n                    type: file.type,\n                    size: `${(file.size / 1024 / 1024).toFixed(2)}MB`,\n                    name: file instanceof File ? file.name : \"blob\"\n                }\n            }\n        });\n        if (result.status_code !== 200) {\n            console.error(\"图床返回错误:\", {\n                result,\n                timestamp: new Date().toISOString(),\n                requestDetails: {\n                    fileType: file.type,\n                    fileSize: `${(file.size / 1024 / 1024).toFixed(2)}MB`\n                }\n            });\n            throw new Error(result.status_txt || \"图片上传失败\");\n        }\n        return result.image.url;\n    } catch (error) {\n        if (retryCount < 2) {\n            console.log(`上传失败，准备重试 (第${retryCount + 1}次):`, {\n                error: error instanceof Error ? error.message : String(error),\n                nextAction: \"尝试压缩后重新上传\",\n                timestamp: new Date().toISOString(),\n                fileInfo: {\n                    type: file.type,\n                    size: `${(file.size / 1024 / 1024).toFixed(2)}MB`,\n                    name: file instanceof File ? file.name : \"blob\"\n                }\n            });\n            const compressedFile = await compressImage(file instanceof File ? file : new File([\n                file\n            ], \"image.jpg\"));\n            return uploadToImageHub(compressedFile, retryCount + 1);\n        }\n        console.error(\"图片上传最终失败:\", {\n            error: error instanceof Error ? error.message : String(error),\n            stack: error instanceof Error ? error.stack : undefined,\n            retryCount,\n            timestamp: new Date().toISOString(),\n            fileDetails: {\n                type: file.type,\n                size: `${(file.size / 1024 / 1024).toFixed(2)}MB`,\n                name: file instanceof File ? file.name : \"blob\"\n            }\n        });\n        throw error;\n    }\n}\nasync function downloadAndUploadImage(url) {\n    try {\n        console.log(\"开始下载图片:\", url);\n        const response = await fetch(url);\n        if (!response.ok) throw new Error(\"图片下载失败\");\n        const blob = await response.blob();\n        console.log(\"图片下载完成，开始上传到图床\");\n        return await uploadToImageHub(blob);\n    } catch (error) {\n        console.error(\"下载并上传图片失败:\", error);\n        throw error;\n    }\n}\nasync function POST(request) {\n    try {\n        // 1. 环境变量验证\n        const requiredEnvVars = [\n            \"WORKFLOW_ID\",\n            \"COZE_API_URL\",\n            \"AUTHORIZATION\",\n            \"IMAGEHUB_API_URL\",\n            \"IMAGEHUB_API_KEY\"\n        ];\n        const missingVars = requiredEnvVars.filter((key)=>!process.env[key]);\n        if (missingVars.length > 0) {\n            console.error(\"缺少环境变量:\", missingVars);\n            return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](JSON.stringify({\n                error: `配置错误: 缺少环境变量 ${missingVars.join(\", \")}`,\n                errorType: \"ConfigError\"\n            }), {\n                status: 500,\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n        }\n        // 2. 请求验证\n        const formData = await request.formData().catch((error)=>{\n            console.error(\"解析表单数据失败:\", error);\n            return null;\n        });\n        if (!formData) {\n            return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](JSON.stringify({\n                error: \"无效的请求数据\",\n                errorType: \"ValidationError\"\n            }), {\n                status: 400,\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n        }\n        const image1 = formData.get(\"image1\");\n        const image2 = formData.get(\"image2\");\n        if (!image1 || !image2) {\n            return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](JSON.stringify({\n                error: \"请提供两张图片\",\n                errorType: \"ValidationError\"\n            }), {\n                status: 400,\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n        }\n        // 3. 图片处理\n        try {\n            console.log(\"开始上传原始图片...\");\n            const [image1Url, image2Url] = await Promise.all([\n                uploadToImageHub(image1),\n                uploadToImageHub(image2)\n            ]);\n            // 4. 调用 Coze API\n            console.log(\"调用 Coze API...\");\n            const cozeResponse = await fetch(process.env.COZE_API_URL, {\n                method: \"POST\",\n                headers: {\n                    \"Authorization\": `Bearer ${process.env.AUTHORIZATION.trim()}`,\n                    \"Content-Type\": \"application/json\",\n                    \"Accept\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    workflow_id: process.env.WORKFLOW_ID.trim(),\n                    parameters: {\n                        face_image: image1Url,\n                        base_image: image2Url\n                    }\n                })\n            });\n            if (!cozeResponse.ok) {\n                const errorText = await cozeResponse.text();\n                console.error(\"Coze API 错误响应:\", errorText);\n                return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](JSON.stringify({\n                    error: \"AI 处理失败\",\n                    errorType: \"CozeAPIError\",\n                    details: errorText\n                }), {\n                    status: 502,\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    }\n                });\n            }\n            const cozeResult = await cozeResponse.json();\n            if (cozeResult.code !== 0) {\n                return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](JSON.stringify({\n                    error: cozeResult.msg || \"AI 处理失败\",\n                    errorType: \"CozeAPIError\",\n                    details: cozeResult\n                }), {\n                    status: 502,\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    }\n                });\n            }\n            // 5. 处理返回的图片\n            const outputData = typeof cozeResult.data === \"string\" ? JSON.parse(cozeResult.data) : cozeResult.data;\n            if (!outputData?.output) {\n                return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](JSON.stringify({\n                    error: \"处理结果无效\",\n                    errorType: \"ProcessError\",\n                    details: cozeResult\n                }), {\n                    status: 500,\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    }\n                });\n            }\n            // 6. 上传结果图片到图床\n            const finalImageUrl = await downloadAndUploadImage(outputData.output);\n            return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](JSON.stringify({\n                resultUrl: finalImageUrl,\n                originalUrl: outputData.output,\n                rawResponse: cozeResult\n            }), {\n                status: 200,\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n        } catch (error) {\n            console.error(\"处理过程错误:\", error);\n            return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](JSON.stringify({\n                error: error instanceof Error ? error.message : \"处理失败\",\n                errorType: \"ProcessError\",\n                details: error instanceof Error ? error.stack : undefined\n            }), {\n                status: 500,\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n        }\n    } catch (error) {\n        // 最外层错误处理\n        console.error(\"API 致命错误:\", error);\n        return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](JSON.stringify({\n            error: \"服务器内部错误\",\n            errorType: \"ServerError\",\n            details: error instanceof Error ? error.stack : undefined\n        }), {\n            status: 500,\n            headers: {\n                \"Content-Type\": \"application/json\"\n            }\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQ0E7Z0JBQ0U1QixRQUFRO2dCQUNSTCxTQUFTO29CQUFFLGdCQUFnQjtnQkFBbUI7WUFDaEQ7UUFFSjtJQUVGLEVBQUUsT0FBT3pCLE9BQU87UUFDZCxVQUFVO1FBQ1ZoQixRQUFRZ0IsS0FBSyxDQUFDLGFBQWFBO1FBQzNCLE9BQU8sSUFBSTlCLGtGQUFZQSxDQUNyQmlHLEtBQUtDLFNBQVMsQ0FBQztZQUNicEUsT0FBTztZQUNQc0UsV0FBVztZQUNYa0IsU0FBU3hGLGlCQUFpQnlDLFFBQVF6QyxNQUFNeUQsS0FBSyxHQUFHQztRQUNsRCxJQUNBO1lBQ0U1QixRQUFRO1lBQ1JMLFNBQVM7Z0JBQUUsZ0JBQWdCO1lBQW1CO1FBQ2hEO0lBRUo7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2ZhY2Utc3dhcC1hcHAvLi9hcHAvYXBpL21lcmdlL3JvdXRlLnRzPzY1NzgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xyXG5pbXBvcnQgc2hhcnAgZnJvbSAnc2hhcnAnXHJcblxyXG5hc3luYyBmdW5jdGlvbiBjb21wcmVzc0ltYWdlKGZpbGU6IEZpbGUpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgYnVmZmVyID0gYXdhaXQgZmlsZS5hcnJheUJ1ZmZlcigpXHJcbiAgICBjb25zdCBmaWxlQnVmZmVyID0gQnVmZmVyLmZyb20oYnVmZmVyKVxyXG5cclxuICAgIGNvbnN0IHJhbmRvbVF1YWxpdHkgPSAwLjU5ICsgTWF0aC5yYW5kb20oKSAqICgwLjk5IC0gMC41OSlcclxuICAgIGNvbnN0IGZpbmFsUXVhbGl0eSA9IE1hdGguZmxvb3IoODAgKiByYW5kb21RdWFsaXR5KVxyXG5cclxuICAgIGNvbnNvbGUubG9nKCfljovnvKnotKjph4/ns7vmlbA6JywgcmFuZG9tUXVhbGl0eS50b0ZpeGVkKDYpKVxyXG4gICAgY29uc29sZS5sb2coJ+acgOe7iOWOi+e8qei0qOmHjzonLCBmaW5hbFF1YWxpdHkpXHJcblxyXG4gICAgY29uc3QgY29tcHJlc3NlZEJ1ZmZlciA9IGF3YWl0IHNoYXJwKGZpbGVCdWZmZXIpXHJcbiAgICAgIC5yZXNpemUoMTkyMCwgMTkyMCwge1xyXG4gICAgICAgIGZpdDogJ2luc2lkZScsXHJcbiAgICAgICAgd2l0aG91dEVubGFyZ2VtZW50OiB0cnVlXHJcbiAgICAgIH0pXHJcbiAgICAgIC5qcGVnKHtcclxuICAgICAgICBxdWFsaXR5OiBmaW5hbFF1YWxpdHksXHJcbiAgICAgICAgcHJvZ3Jlc3NpdmU6IHRydWVcclxuICAgICAgfSlcclxuICAgICAgLnRvQnVmZmVyKClcclxuXHJcbiAgICBjb25zdCBjb21wcmVzc2VkRmlsZSA9IG5ldyBGaWxlKFxyXG4gICAgICBbY29tcHJlc3NlZEJ1ZmZlcl0sXHJcbiAgICAgIGZpbGUubmFtZSxcclxuICAgICAgeyB0eXBlOiAnaW1hZ2UvanBlZycgfVxyXG4gICAgKVxyXG5cclxuICAgIGNvbnNvbGUubG9nKCfljovnvKnliY3lpKflsI86JywgKGZpbGUuc2l6ZSAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpICsgJ01CJylcclxuICAgIGNvbnNvbGUubG9nKCfljovnvKnlkI7lpKflsI86JywgKGNvbXByZXNzZWRGaWxlLnNpemUgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgyKSArICdNQicpXHJcblxyXG4gICAgcmV0dXJuIGNvbXByZXNzZWRGaWxlXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+WbvueJh+WOi+e8qeWksei0pTonLCBlcnJvcilcclxuICAgIHJldHVybiBmaWxlXHJcbiAgfVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiB1cGxvYWRUb0ltYWdlSHViKGZpbGU6IEZpbGUgfCBCbG9iLCByZXRyeUNvdW50ID0gMCk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKClcclxuICAgIGZvcm1EYXRhLmFwcGVuZCgnc291cmNlJywgZmlsZSlcclxuXHJcbiAgICBjb25zb2xlLmxvZygn5YeG5aSH5LiK5Lyg5Zu+54mH5Yiw5Zu+5bqKOicsIHtcclxuICAgICAgdXJsOiBwcm9jZXNzLmVudi5JTUFHRUhVQl9BUElfVVJMLFxyXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgZmlsZToge1xyXG4gICAgICAgIHR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICBzaXplOiBgJHsoZmlsZS5zaXplIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMil9TUJgLFxyXG4gICAgICAgIGxhc3RNb2RpZmllZDogZmlsZSBpbnN0YW5jZW9mIEZpbGUgPyBuZXcgRGF0ZShmaWxlLmxhc3RNb2RpZmllZCkudG9JU09TdHJpbmcoKSA6ICdOL0EnLFxyXG4gICAgICAgIG5hbWU6IGZpbGUgaW5zdGFuY2VvZiBGaWxlID8gZmlsZS5uYW1lIDogJ2Jsb2InXHJcbiAgICAgIH0sXHJcbiAgICAgIHJldHJ5Q291bnRcclxuICAgIH0pXHJcblxyXG4gICAgY29uc3QgcmVxdWVzdEhlYWRlcnMgPSB7XHJcbiAgICAgICdYLUFQSS1LZXknOiAnKioqJyArIHByb2Nlc3MuZW52LklNQUdFSFVCX0FQSV9LRVkhLnNsaWNlKC02KVxyXG4gICAgfVxyXG4gICAgY29uc29sZS5sb2coJ+ivt+axguWktDonLCByZXF1ZXN0SGVhZGVycylcclxuXHJcbiAgICBjb25zb2xlLmxvZygnRm9ybURhdGEg5YaF5a65OicpXHJcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBmb3JtRGF0YS5lbnRyaWVzKCkpIHtcclxuICAgICAgY29uc29sZS5sb2coJy0gJywga2V5LCAnOicsIHtcclxuICAgICAgICB0eXBlOiB2YWx1ZSBpbnN0YW5jZW9mIEJsb2IgPyB2YWx1ZS50eXBlIDogdHlwZW9mIHZhbHVlLFxyXG4gICAgICAgIHNpemU6IHZhbHVlIGluc3RhbmNlb2YgQmxvYiA/IGAkeyh2YWx1ZS5zaXplIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMil9TUJgIDogJ04vQScsXHJcbiAgICAgICAgbmFtZTogdmFsdWUgaW5zdGFuY2VvZiBGaWxlID8gdmFsdWUubmFtZSA6ICdibG9iJ1xyXG4gICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KClcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2gocHJvY2Vzcy5lbnYuSU1BR0VIVUJfQVBJX1VSTCEsIHtcclxuICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnWC1BUEktS2V5JzogcHJvY2Vzcy5lbnYuSU1BR0VIVUJfQVBJX0tFWSEsXHJcbiAgICAgIH0sXHJcbiAgICAgIGJvZHk6IGZvcm1EYXRhXHJcbiAgICB9KVxyXG5cclxuICAgIGNvbnN0IGVuZFRpbWUgPSBEYXRlLm5vdygpXHJcblxyXG4gICAgY29uc29sZS5sb2coJ+WbvuW6iuWTjeW6lOivpuaDhTonLCB7XHJcbiAgICAgIHRpbWluZzoge1xyXG4gICAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoc3RhcnRUaW1lKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIGVuZFRpbWU6IG5ldyBEYXRlKGVuZFRpbWUpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgZHVyYXRpb246IGAke2VuZFRpbWUgLSBzdGFydFRpbWV9bXNgXHJcbiAgICAgIH0sXHJcbiAgICAgIHN0YXR1czoge1xyXG4gICAgICAgIGNvZGU6IHJlc3BvbnNlLnN0YXR1cyxcclxuICAgICAgICB0ZXh0OiByZXNwb25zZS5zdGF0dXNUZXh0XHJcbiAgICAgIH0sXHJcbiAgICAgIGhlYWRlcnM6IE9iamVjdC5mcm9tRW50cmllcyhyZXNwb25zZS5oZWFkZXJzLmVudHJpZXMoKSksXHJcbiAgICAgIHR5cGU6IHJlc3BvbnNlLnR5cGUsXHJcbiAgICAgIHVybDogcmVzcG9uc2UudXJsLFxyXG4gICAgICByZWRpcmVjdGVkOiByZXNwb25zZS5yZWRpcmVjdGVkXHJcbiAgICB9KVxyXG5cclxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+WbvuW6iuS4iuS8oOWksei0pTonLCB7XHJcbiAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXHJcbiAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCxcclxuICAgICAgICByZXNwb25zZUJvZHk6IGVycm9yVGV4dCxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KVxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ+WbvueJh+S4iuS8oOWksei0pScpXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXHJcbiAgICBjb25zb2xlLmxvZygn5Zu+5bqK5LiK5Lyg5oiQ5YqfOicsIHtcclxuICAgICAgdGltaW5nOiB7XHJcbiAgICAgICAgdG90YWw6IGAke2VuZFRpbWUgLSBzdGFydFRpbWV9bXNgLFxyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0sXHJcbiAgICAgIHJlc3BvbnNlOiB7XHJcbiAgICAgICAgc3RhdHVzX2NvZGU6IHJlc3VsdC5zdGF0dXNfY29kZSxcclxuICAgICAgICBzdGF0dXNfdHh0OiByZXN1bHQuc3RhdHVzX3R4dCxcclxuICAgICAgICBpbWFnZTogcmVzdWx0LmltYWdlXHJcbiAgICAgIH0sXHJcbiAgICAgIHJlcXVlc3Q6IHtcclxuICAgICAgICBvcmlnaW5hbEZpbGU6IHtcclxuICAgICAgICAgIHR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICAgIHNpemU6IGAkeyhmaWxlLnNpemUgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgyKX1NQmAsXHJcbiAgICAgICAgICBuYW1lOiBmaWxlIGluc3RhbmNlb2YgRmlsZSA/IGZpbGUubmFtZSA6ICdibG9iJ1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBpZiAocmVzdWx0LnN0YXR1c19jb2RlICE9PSAyMDApIHtcclxuICAgICAgY29uc29sZS5lcnJvcign5Zu+5bqK6L+U5Zue6ZSZ6K+vOicsIHtcclxuICAgICAgICByZXN1bHQsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgcmVxdWVzdERldGFpbHM6IHtcclxuICAgICAgICAgIGZpbGVUeXBlOiBmaWxlLnR5cGUsXHJcbiAgICAgICAgICBmaWxlU2l6ZTogYCR7KGZpbGUuc2l6ZSAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpfU1CYFxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3VsdC5zdGF0dXNfdHh0IHx8ICflm77niYfkuIrkvKDlpLHotKUnKVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXN1bHQuaW1hZ2UudXJsXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGlmIChyZXRyeUNvdW50IDwgMikge1xyXG4gICAgICBjb25zb2xlLmxvZyhg5LiK5Lyg5aSx6LSl77yM5YeG5aSH6YeN6K+VICjnrKwke3JldHJ5Q291bnQgKyAxfeasoSk6YCwge1xyXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXHJcbiAgICAgICAgbmV4dEFjdGlvbjogJ+WwneivleWOi+e8qeWQjumHjeaWsOS4iuS8oCcsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgZmlsZUluZm86IHtcclxuICAgICAgICAgIHR5cGU6IGZpbGUudHlwZSxcclxuICAgICAgICAgIHNpemU6IGAkeyhmaWxlLnNpemUgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgyKX1NQmAsXHJcbiAgICAgICAgICBuYW1lOiBmaWxlIGluc3RhbmNlb2YgRmlsZSA/IGZpbGUubmFtZSA6ICdibG9iJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgY29uc3QgY29tcHJlc3NlZEZpbGUgPSBhd2FpdCBjb21wcmVzc0ltYWdlKGZpbGUgaW5zdGFuY2VvZiBGaWxlID8gZmlsZSA6IG5ldyBGaWxlKFtmaWxlXSwgJ2ltYWdlLmpwZycpKVxyXG4gICAgICByZXR1cm4gdXBsb2FkVG9JbWFnZUh1Yihjb21wcmVzc2VkRmlsZSwgcmV0cnlDb3VudCArIDEpXHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmVycm9yKCflm77niYfkuIrkvKDmnIDnu4jlpLHotKU6Jywge1xyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxyXG4gICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkLFxyXG4gICAgICByZXRyeUNvdW50LFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgZmlsZURldGFpbHM6IHtcclxuICAgICAgICB0eXBlOiBmaWxlLnR5cGUsXHJcbiAgICAgICAgc2l6ZTogYCR7KGZpbGUuc2l6ZSAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpfU1CYCxcclxuICAgICAgICBuYW1lOiBmaWxlIGluc3RhbmNlb2YgRmlsZSA/IGZpbGUubmFtZSA6ICdibG9iJ1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgdGhyb3cgZXJyb3JcclxuICB9XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGRvd25sb2FkQW5kVXBsb2FkSW1hZ2UodXJsOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZygn5byA5aeL5LiL6L295Zu+54mHOicsIHVybClcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsKVxyXG4gICAgaWYgKCFyZXNwb25zZS5vaykgdGhyb3cgbmV3IEVycm9yKCflm77niYfkuIvovb3lpLHotKUnKVxyXG4gICAgXHJcbiAgICBjb25zdCBibG9iID0gYXdhaXQgcmVzcG9uc2UuYmxvYigpXHJcbiAgICBjb25zb2xlLmxvZygn5Zu+54mH5LiL6L295a6M5oiQ77yM5byA5aeL5LiK5Lyg5Yiw5Zu+5bqKJylcclxuICAgIFxyXG4gICAgcmV0dXJuIGF3YWl0IHVwbG9hZFRvSW1hZ2VIdWIoYmxvYilcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcign5LiL6L295bm25LiK5Lyg5Zu+54mH5aSx6LSlOicsIGVycm9yKVxyXG4gICAgdGhyb3cgZXJyb3JcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIDEuIOeOr+Wig+WPmOmHj+mqjOivgVxyXG4gICAgY29uc3QgcmVxdWlyZWRFbnZWYXJzID0gW1xyXG4gICAgICAnV09SS0ZMT1dfSUQnLFxyXG4gICAgICAnQ09aRV9BUElfVVJMJyxcclxuICAgICAgJ0FVVEhPUklaQVRJT04nLFxyXG4gICAgICAnSU1BR0VIVUJfQVBJX1VSTCcsXHJcbiAgICAgICdJTUFHRUhVQl9BUElfS0VZJ1xyXG4gICAgXVxyXG4gICAgXHJcbiAgICBjb25zdCBtaXNzaW5nVmFycyA9IHJlcXVpcmVkRW52VmFycy5maWx0ZXIoa2V5ID0+ICFwcm9jZXNzLmVudltrZXldKVxyXG4gICAgaWYgKG1pc3NpbmdWYXJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc29sZS5lcnJvcign57y65bCR546v5aKD5Y+Y6YePOicsIG1pc3NpbmdWYXJzKVxyXG4gICAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShcclxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICBlcnJvcjogYOmFjee9rumUmeivrzog57y65bCR546v5aKD5Y+Y6YePICR7bWlzc2luZ1ZhcnMuam9pbignLCAnKX1gLFxyXG4gICAgICAgICAgZXJyb3JUeXBlOiAnQ29uZmlnRXJyb3InXHJcbiAgICAgICAgfSksXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgc3RhdHVzOiA1MDAsXHJcbiAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfVxyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIDIuIOivt+axgumqjOivgVxyXG4gICAgY29uc3QgZm9ybURhdGEgPSBhd2FpdCByZXF1ZXN0LmZvcm1EYXRhKCkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCfop6PmnpDooajljZXmlbDmja7lpLHotKU6JywgZXJyb3IpXHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9KVxyXG5cclxuICAgIGlmICghZm9ybURhdGEpIHtcclxuICAgICAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UoXHJcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgZXJyb3I6ICfml6DmlYjnmoTor7fmsYLmlbDmja4nLFxyXG4gICAgICAgICAgZXJyb3JUeXBlOiAnVmFsaWRhdGlvbkVycm9yJ1xyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHN0YXR1czogNDAwLFxyXG4gICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH1cclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpbWFnZTEgPSBmb3JtRGF0YS5nZXQoJ2ltYWdlMScpIGFzIEZpbGVcclxuICAgIGNvbnN0IGltYWdlMiA9IGZvcm1EYXRhLmdldCgnaW1hZ2UyJykgYXMgRmlsZVxyXG5cclxuICAgIGlmICghaW1hZ2UxIHx8ICFpbWFnZTIpIHtcclxuICAgICAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UoXHJcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgZXJyb3I6ICfor7fmj5DkvpvkuKTlvKDlm77niYcnLFxyXG4gICAgICAgICAgZXJyb3JUeXBlOiAnVmFsaWRhdGlvbkVycm9yJ1xyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHN0YXR1czogNDAwLFxyXG4gICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH1cclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgIH1cclxuXHJcbiAgICAvLyAzLiDlm77niYflpITnkIZcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCflvIDlp4vkuIrkvKDljp/lp4vlm77niYcuLi4nKVxyXG4gICAgICBjb25zdCBbaW1hZ2UxVXJsLCBpbWFnZTJVcmxdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgIHVwbG9hZFRvSW1hZ2VIdWIoaW1hZ2UxKSxcclxuICAgICAgICB1cGxvYWRUb0ltYWdlSHViKGltYWdlMilcclxuICAgICAgXSlcclxuXHJcbiAgICAgIC8vIDQuIOiwg+eUqCBDb3plIEFQSVxyXG4gICAgICBjb25zb2xlLmxvZygn6LCD55SoIENvemUgQVBJLi4uJylcclxuICAgICAgY29uc3QgY296ZVJlc3BvbnNlID0gYXdhaXQgZmV0Y2gocHJvY2Vzcy5lbnYuQ09aRV9BUElfVVJMISwge1xyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3Byb2Nlc3MuZW52LkFVVEhPUklaQVRJT04hLnRyaW0oKX1gLFxyXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICB9LFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgIHdvcmtmbG93X2lkOiBwcm9jZXNzLmVudi5XT1JLRkxPV19JRCEudHJpbSgpLFxyXG4gICAgICAgICAgcGFyYW1ldGVyczogeyBmYWNlX2ltYWdlOiBpbWFnZTFVcmwsIGJhc2VfaW1hZ2U6IGltYWdlMlVybCB9XHJcbiAgICAgICAgfSlcclxuICAgICAgfSlcclxuXHJcbiAgICAgIGlmICghY296ZVJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgY296ZVJlc3BvbnNlLnRleHQoKVxyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NvemUgQVBJIOmUmeivr+WTjeW6lDonLCBlcnJvclRleHQpXHJcbiAgICAgICAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UoXHJcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgIGVycm9yOiAnQUkg5aSE55CG5aSx6LSlJyxcclxuICAgICAgICAgICAgZXJyb3JUeXBlOiAnQ296ZUFQSUVycm9yJyxcclxuICAgICAgICAgICAgZGV0YWlsczogZXJyb3JUZXh0XHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgc3RhdHVzOiA1MDIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBjb3plUmVzdWx0ID0gYXdhaXQgY296ZVJlc3BvbnNlLmpzb24oKVxyXG4gICAgICBcclxuICAgICAgaWYgKGNvemVSZXN1bHQuY29kZSAhPT0gMCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKFxyXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICBlcnJvcjogY296ZVJlc3VsdC5tc2cgfHwgJ0FJIOWkhOeQhuWksei0pScsXHJcbiAgICAgICAgICAgIGVycm9yVHlwZTogJ0NvemVBUElFcnJvcicsXHJcbiAgICAgICAgICAgIGRldGFpbHM6IGNvemVSZXN1bHRcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBzdGF0dXM6IDUwMixcclxuICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIDUuIOWkhOeQhui/lOWbnueahOWbvueJh1xyXG4gICAgICBjb25zdCBvdXRwdXREYXRhID0gdHlwZW9mIGNvemVSZXN1bHQuZGF0YSA9PT0gJ3N0cmluZycgXHJcbiAgICAgICAgPyBKU09OLnBhcnNlKGNvemVSZXN1bHQuZGF0YSkgXHJcbiAgICAgICAgOiBjb3plUmVzdWx0LmRhdGFcclxuXHJcbiAgICAgIGlmICghb3V0cHV0RGF0YT8ub3V0cHV0KSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UoXHJcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgIGVycm9yOiAn5aSE55CG57uT5p6c5peg5pWIJyxcclxuICAgICAgICAgICAgZXJyb3JUeXBlOiAnUHJvY2Vzc0Vycm9yJyxcclxuICAgICAgICAgICAgZGV0YWlsczogY296ZVJlc3VsdFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIHN0YXR1czogNTAwLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIClcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gNi4g5LiK5Lyg57uT5p6c5Zu+54mH5Yiw5Zu+5bqKXHJcbiAgICAgIGNvbnN0IGZpbmFsSW1hZ2VVcmwgPSBhd2FpdCBkb3dubG9hZEFuZFVwbG9hZEltYWdlKG91dHB1dERhdGEub3V0cHV0KVxyXG5cclxuICAgICAgcmV0dXJuIG5ldyBOZXh0UmVzcG9uc2UoXHJcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgcmVzdWx0VXJsOiBmaW5hbEltYWdlVXJsLFxyXG4gICAgICAgICAgb3JpZ2luYWxVcmw6IG91dHB1dERhdGEub3V0cHV0LFxyXG4gICAgICAgICAgcmF3UmVzcG9uc2U6IGNvemVSZXN1bHRcclxuICAgICAgICB9KSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBzdGF0dXM6IDIwMCxcclxuICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9XHJcbiAgICAgICAgfVxyXG4gICAgICApXHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcign5aSE55CG6L+H56iL6ZSZ6K+vOicsIGVycm9yKVxyXG4gICAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShcclxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAn5aSE55CG5aSx6LSlJyxcclxuICAgICAgICAgIGVycm9yVHlwZTogJ1Byb2Nlc3NFcnJvcicsXHJcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWRcclxuICAgICAgICB9KSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBzdGF0dXM6IDUwMCxcclxuICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9XHJcbiAgICAgICAgfVxyXG4gICAgICApXHJcbiAgICB9XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAvLyDmnIDlpJblsYLplJnor6/lpITnkIZcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0FQSSDoh7Tlkb3plJnor686JywgZXJyb3IpXHJcbiAgICByZXR1cm4gbmV3IE5leHRSZXNwb25zZShcclxuICAgICAgSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGVycm9yOiAn5pyN5Yqh5Zmo5YaF6YOo6ZSZ6K+vJyxcclxuICAgICAgICBlcnJvclR5cGU6ICdTZXJ2ZXJFcnJvcicsXHJcbiAgICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkXHJcbiAgICAgIH0pLFxyXG4gICAgICB7XHJcbiAgICAgICAgc3RhdHVzOiA1MDAsXHJcbiAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH1cclxuICAgICAgfVxyXG4gICAgKVxyXG4gIH1cclxufSAiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwic2hhcnAiLCJjb21wcmVzc0ltYWdlIiwiZmlsZSIsImJ1ZmZlciIsImFycmF5QnVmZmVyIiwiZmlsZUJ1ZmZlciIsIkJ1ZmZlciIsImZyb20iLCJyYW5kb21RdWFsaXR5IiwiTWF0aCIsInJhbmRvbSIsImZpbmFsUXVhbGl0eSIsImZsb29yIiwiY29uc29sZSIsImxvZyIsInRvRml4ZWQiLCJjb21wcmVzc2VkQnVmZmVyIiwicmVzaXplIiwiZml0Iiwid2l0aG91dEVubGFyZ2VtZW50IiwianBlZyIsInF1YWxpdHkiLCJwcm9ncmVzc2l2ZSIsInRvQnVmZmVyIiwiY29tcHJlc3NlZEZpbGUiLCJGaWxlIiwibmFtZSIsInR5cGUiLCJzaXplIiwiZXJyb3IiLCJ1cGxvYWRUb0ltYWdlSHViIiwicmV0cnlDb3VudCIsImZvcm1EYXRhIiwiRm9ybURhdGEiLCJhcHBlbmQiLCJ1cmwiLCJwcm9jZXNzIiwiZW52IiwiSU1BR0VIVUJfQVBJX1VSTCIsIm1ldGhvZCIsImxhc3RNb2RpZmllZCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInJlcXVlc3RIZWFkZXJzIiwiSU1BR0VIVUJfQVBJX0tFWSIsInNsaWNlIiwia2V5IiwidmFsdWUiLCJlbnRyaWVzIiwiQmxvYiIsInN0YXJ0VGltZSIsIm5vdyIsInJlc3BvbnNlIiwiZmV0Y2giLCJoZWFkZXJzIiwiYm9keSIsImVuZFRpbWUiLCJ0aW1pbmciLCJkdXJhdGlvbiIsInN0YXR1cyIsImNvZGUiLCJ0ZXh0Iiwic3RhdHVzVGV4dCIsIk9iamVjdCIsImZyb21FbnRyaWVzIiwicmVkaXJlY3RlZCIsIm9rIiwiZXJyb3JUZXh0IiwicmVzcG9uc2VCb2R5IiwidGltZXN0YW1wIiwiRXJyb3IiLCJyZXN1bHQiLCJqc29uIiwidG90YWwiLCJzdGF0dXNfY29kZSIsInN0YXR1c190eHQiLCJpbWFnZSIsInJlcXVlc3QiLCJvcmlnaW5hbEZpbGUiLCJyZXF1ZXN0RGV0YWlscyIsImZpbGVUeXBlIiwiZmlsZVNpemUiLCJtZXNzYWdlIiwiU3RyaW5nIiwibmV4dEFjdGlvbiIsImZpbGVJbmZvIiwic3RhY2siLCJ1bmRlZmluZWQiLCJmaWxlRGV0YWlscyIsImRvd25sb2FkQW5kVXBsb2FkSW1hZ2UiLCJibG9iIiwiUE9TVCIsInJlcXVpcmVkRW52VmFycyIsIm1pc3NpbmdWYXJzIiwiZmlsdGVyIiwibGVuZ3RoIiwiSlNPTiIsInN0cmluZ2lmeSIsImpvaW4iLCJlcnJvclR5cGUiLCJjYXRjaCIsImltYWdlMSIsImdldCIsImltYWdlMiIsImltYWdlMVVybCIsImltYWdlMlVybCIsIlByb21pc2UiLCJhbGwiLCJjb3plUmVzcG9uc2UiLCJDT1pFX0FQSV9VUkwiLCJBVVRIT1JJWkFUSU9OIiwidHJpbSIsIndvcmtmbG93X2lkIiwiV09SS0ZMT1dfSUQiLCJwYXJhbWV0ZXJzIiwiZmFjZV9pbWFnZSIsImJhc2VfaW1hZ2UiLCJkZXRhaWxzIiwiY296ZVJlc3VsdCIsIm1zZyIsIm91dHB1dERhdGEiLCJkYXRhIiwicGFyc2UiLCJvdXRwdXQiLCJmaW5hbEltYWdlVXJsIiwicmVzdWx0VXJsIiwib3JpZ2luYWxVcmwiLCJyYXdSZXNwb25zZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/merge/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fmerge%2Froute&page=%2Fapi%2Fmerge%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmerge%2Froute.ts&appDir=D%3A%5CCursor%5Cface2exchange%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CCursor%5Cface2exchange&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();