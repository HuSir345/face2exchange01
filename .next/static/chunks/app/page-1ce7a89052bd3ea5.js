(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5497:function(e,t,a){Promise.resolve().then(a.bind(a,830))},830:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Home}});var s=a(7437),n=a(2265),r=a(6691),i=a.n(r);function ImageUploader(e){let{onProcess:t,status:a,onImageChange:r,onError:o}=e,[l,c]=(0,n.useState)([]),[d,m]=(0,n.useState)(!1),handleImageChange=(e,t)=>{var a;let s=null===(a=e.target.files)||void 0===a?void 0:a[0];if(!s)return;if(!s.type.startsWith("image/")){null==o||o("请上传图片文件");return}let n=new FileReader;n.onload=e=>{var a;let n=[...l];n[t]={url:null===(a=e.target)||void 0===a?void 0:a.result,file:s},c(n)},n.readAsDataURL(s)},handleSubmit=async()=>{if(!l[0]||!l[1]){null==o||o("请上传两张图片");return}if(!d)try{m(!0),await t(l[0].file,l[1].file)}catch(e){console.error("处理图片时出错:",e),null==o||o(e instanceof Error?e.message:"处理图片时出错")}finally{m(!1)}};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[0,1].map(e=>(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:t=>handleImageChange(t,e),className:"hidden",id:"image-input-".concat(e)}),(0,s.jsx)("label",{htmlFor:"image-input-".concat(e),className:"\n                block w-full aspect-square border-2 border-dashed rounded-lg \n                cursor-pointer hover:border-gray-400 transition-colors\n                ".concat("processing"===a?"opacity-50 pointer-events-none":"","\n              "),children:l[e]?(0,s.jsx)("div",{className:"relative w-full h-full",children:(0,s.jsx)(i(),{src:l[e].url,alt:"预览图 ".concat(e+1),width:400,height:400,className:"object-cover rounded-lg w-full h-full"})}):(0,s.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-gray-500 text-lg font-bold",children:0===e?"上传第一张图片":"上传第二张图片"})})})]},e))}),(0,s.jsx)("button",{onClick:handleSubmit,disabled:"processing"===a||!l[0]||!l[1]||d,className:"\n          w-full py-3 px-4 rounded-lg font-medium transition-colors\n          ".concat(d||"processing"===a?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white","\n        "),children:d||"processing"===a?(0,s.jsxs)("span",{className:"flex items-center justify-center",children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中..."]}):"开始合成"})]})}function ResultDisplay(e){let{imageUrl:t}=e;return(0,s.jsxs)("div",{className:"mt-12 space-y-4",children:[(0,s.jsx)("h2",{className:"text-2xl text-center",style:{fontFamily:"'Comic Sans MS', 'Chalkboard SE', 'Marker Felt', sans-serif",background:"linear-gradient(45deg, #FF69B4, #FF1493)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"1px 1px 2px rgba(0,0,0,0.1)",fontWeight:"bold"},children:"换脸后都说好 ✨"}),(0,s.jsx)("div",{className:"relative aspect-square w-full max-w-2xl mx-auto",children:(0,s.jsx)(i(),{src:t,alt:"合成结果",fill:!0,className:"object-contain"})}),(0,s.jsx)("button",{onClick:()=>{window.open(t,"_blank")},className:"block w-full max-w-md mx-auto py-3 px-4 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors",children:"下载图片"})]})}function LogViewer(e){let{logs:t,onClear:a}=e;return(0,s.jsxs)("div",{className:"mb-8 bg-black rounded-lg p-4 text-sm font-mono",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("h2",{className:"text-white font-semibold",children:"系统日志"}),(0,s.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-white text-xs",children:"清除日志"})]}),(0,s.jsxs)("div",{className:"h-48 overflow-y-auto",children:[t.map((e,t)=>(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsxs)("div",{className:"\n              ".concat("error"===e.type?"text-red-400":"success"===e.type?"text-green-400":"debug"===e.type?"text-yellow-400":"text-blue-400","\n            "),children:[(0,s.jsx)("span",{className:"text-gray-500",children:e.timestamp})," ",(0,s.jsxs)("span",{className:"text-gray-400",children:["[",e.type.toUpperCase(),"]"]})," ",e.message]}),e.details&&(0,s.jsx)("pre",{className:"ml-4 mt-1 text-gray-400 text-xs whitespace-pre-wrap",children:e.details})]},t)),0===t.length&&(0,s.jsx)("div",{className:"text-gray-500 italic",children:"等待操作..."})]})]})}function Home(){let[e,t]=(0,n.useState)("idle"),[a,r]=(0,n.useState)(null),[i,o]=(0,n.useState)(null),[l,c]=(0,n.useState)([]),addLog=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=arguments.length>2?arguments[2]:void 0,s=new Date().toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),n="[".concat(s,"] [").concat(t.toUpperCase(),"] ").concat(e);switch(t){case"error":console.error(n,a||"");break;case"success":console.log("%c"+n,"color: green",a||"");break;case"debug":console.debug(n,a||"");break;default:console.log(n,a||"")}c(n=>[...n,{timestamp:s,type:t,message:e,details:a}])},handleProcess=async(e,a)=>{try{var s;let n;t("processing"),o(null),c([]),addLog("开始处理图片任务","info"),addLog("浏览器环境信息","debug",JSON.stringify({userAgent:navigator.userAgent,timestamp:new Date().toISOString(),screenSize:"".concat(window.innerWidth,"x").concat(window.innerHeight),platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,memory:(null===(s=performance)||void 0===s?void 0:s.memory)?{jsHeapSizeLimit:(performance.memory.jsHeapSizeLimit/1024/1024).toFixed(2)+"MB",totalJSHeapSize:(performance.memory.totalJSHeapSize/1024/1024).toFixed(2)+"MB",usedJSHeapSize:(performance.memory.usedJSHeapSize/1024/1024).toFixed(2)+"MB"}:"Not available"},null,2)),addLog("图片详细信息","debug",JSON.stringify({image1:{name:e.name,size:"".concat((e.size/1024).toFixed(2),"KB"),type:e.type,lastModified:new Date(e.lastModified).toISOString(),dimensions:await getImageDimensions(e)},image2:{name:a.name,size:"".concat((a.size/1024).toFixed(2),"KB"),type:a.type,lastModified:new Date(a.lastModified).toISOString(),dimensions:await getImageDimensions(a)}},null,2));let i=new FormData;i.append("image1",e),i.append("image2",a),addLog("准备发送请求到服务器","info",JSON.stringify({endpoint:"/api/merge",method:"POST",contentType:"multipart/form-data",timestamp:new Date().toISOString()},null,2));let l=Date.now(),d="",m=await fetch("/api/merge",{method:"POST",body:i});n=Date.now();let g=n-l;addLog("收到服务器初始响应，耗时: ".concat(g,"ms"),"info");let u=Object.fromEntries(m.headers.entries());addLog("服务器响应详情","debug",JSON.stringify({status:m.status,statusText:m.statusText,headers:u,type:m.type,url:m.url,redirected:m.redirected,ok:m.ok},null,2));try{d=await m.text(),addLog("服务器原始响应内容","debug",d);let e=JSON.parse(d);if(addLog("解析后的响应数据","debug",JSON.stringify(e,null,2)),!m.ok)throw Error(e.error||"服务器错误 (".concat(m.status,")"));addLog("图片处理成功","success"),e.resultUrl&&(addLog("生成的图片URL","info",e.resultUrl),addLog("处理完成时间","info",JSON.stringify({totalTime:"".concat(Date.now()-l,"ms"),serverProcessing:"".concat(g,"ms"),responseProcessing:"".concat(Date.now()-n,"ms")},null,2))),r(e.resultUrl),t("success")}catch(e){throw addLog("解析响应失败","error",JSON.stringify({error:e instanceof Error?e.message:String(e),responseText:d,contentType:u["content-type"],contentLength:u["content-length"]},null,2)),Error("无法解析服务器响应")}}catch(a){let e={message:a.message,stack:a.stack,timestamp:new Date().toISOString(),type:a.name,code:a.code,cause:a.cause?{message:a.cause.message,stack:a.cause.stack}:void 0,networkError:a instanceof TypeError&&a.message.includes("network"),parseError:a instanceof SyntaxError};addLog("处理失败","error",a.message),addLog("错误详细信息","debug",JSON.stringify(e,null,2)),o(a.message||"处理失败"),t("error")}},getImageDimensions=e=>new Promise(t=>{let a=new Image;a.onload=()=>{t({width:a.width,height:a.height})},a.src=URL.createObjectURL(e)});return(0,s.jsx)("main",{className:"min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto py-12 px-4",children:[(0,s.jsxs)("h1",{className:"text-4xl font-bold text-center mb-8",children:["一起玩",(0,s.jsx)("span",{className:"inline-block px-2 py-1 mx-1 bg-blue-600 text-white rounded-lg transform hover:scale-105 transition-transform",children:"换脸"})]}),(0,s.jsx)(LogViewer,{logs:l,onClear:()=>c([])}),(0,s.jsx)(ImageUploader,{onProcess:handleProcess,status:e,onImageChange:()=>{r(null),o(null),t("idle"),c([])},onError:e=>{o(e),addLog(e,"error")}}),i&&(0,s.jsx)("div",{className:"mt-4 p-4 bg-red-100 text-red-700 rounded-lg",children:i}),a&&(0,s.jsx)(ResultDisplay,{imageUrl:a})]})})}}},function(e){e.O(0,[986,971,472,744],function(){return e(e.s=5497)}),_N_E=e.O()}]);