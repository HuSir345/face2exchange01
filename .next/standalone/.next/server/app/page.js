(()=>{var e={};e.id=931,e.ids=[931],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},1755:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>g,pages:()=>d,routeModule:()=>u,tree:()=>c});var a=s(7096),r=s(6132),n=s(7284),i=s.n(n),o=s(2564),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3982)),"D:\\Cursor\\face2exchange\\app\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,5345)),"D:\\Cursor\\face2exchange\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"]}],d=["D:\\Cursor\\face2exchange\\app\\page.tsx"],g="/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5054:(e,t,s)=>{Promise.resolve().then(s.bind(s,4067))},4067:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Home});var a=s(784),r=s(9885),n=s(2451),i=s.n(n);function ImageUploader({onProcess:e,status:t,onImageChange:s,onError:n}){let[o,l]=(0,r.useState)([]),[c,d]=(0,r.useState)(!1),handleImageChange=(e,t)=>{let s=e.target.files?.[0];if(!s)return;if(!s.type.startsWith("image/")){n?.("请上传图片文件");return}let a=new FileReader;a.onload=e=>{let a=[...o];a[t]={url:e.target?.result,file:s},l(a)},a.readAsDataURL(s)},handleSubmit=async()=>{if(!o[0]||!o[1]){n?.("请上传两张图片");return}if(!c)try{d(!0),await e(o[0].file,o[1].file)}catch(e){console.error("处理图片时出错:",e),n?.(e instanceof Error?e.message:"处理图片时出错")}finally{d(!1)}};return(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[0,1].map(e=>(0,a.jsxs)("div",{className:"relative",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:t=>handleImageChange(t,e),className:"hidden",id:`image-input-${e}`}),a.jsx("label",{htmlFor:`image-input-${e}`,className:`
                block w-full aspect-square border-2 border-dashed rounded-lg 
                cursor-pointer hover:border-gray-400 transition-colors
                ${"processing"===t?"opacity-50 pointer-events-none":""}
              `,children:o[e]?a.jsx("div",{className:"relative w-full h-full",children:a.jsx(i(),{src:o[e].url,alt:`预览图 ${e+1}`,width:400,height:400,className:"object-cover rounded-lg w-full h-full"})}):a.jsx("div",{className:"h-full flex items-center justify-center",children:a.jsx("span",{className:"text-gray-500 text-lg font-bold",children:0===e?"上传第一张图片":"上传第二张图片"})})})]},e))}),a.jsx("button",{onClick:handleSubmit,disabled:"processing"===t||!o[0]||!o[1]||c,className:`
          w-full py-3 px-4 rounded-lg font-medium transition-colors
          ${c||"processing"===t?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}
        `,children:c||"processing"===t?(0,a.jsxs)("span",{className:"flex items-center justify-center",children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中..."]}):"开始合成"})]})}function ResultDisplay({imageUrl:e}){return(0,a.jsxs)("div",{className:"mt-12 space-y-4",children:[a.jsx("h2",{className:"text-2xl text-center",style:{fontFamily:"'Comic Sans MS', 'Chalkboard SE', 'Marker Felt', sans-serif",background:"linear-gradient(45deg, #FF69B4, #FF1493)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"1px 1px 2px rgba(0,0,0,0.1)",fontWeight:"bold"},children:"换脸后都说好 ✨"}),a.jsx("div",{className:"relative aspect-square w-full max-w-2xl mx-auto",children:a.jsx(i(),{src:e,alt:"合成结果",fill:!0,className:"object-contain"})}),a.jsx("button",{onClick:()=>{window.open(e,"_blank")},className:"block w-full max-w-md mx-auto py-3 px-4 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors",children:"下载图片"})]})}function LogViewer({logs:e,onClear:t}){return(0,a.jsxs)("div",{className:"mb-8 bg-black rounded-lg p-4 text-sm font-mono",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("h2",{className:"text-white font-semibold",children:"系统日志"}),a.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white text-xs",children:"清除日志"})]}),(0,a.jsxs)("div",{className:"h-48 overflow-y-auto",children:[e.map((e,t)=>(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsxs)("div",{className:`
              ${"error"===e.type?"text-red-400":"success"===e.type?"text-green-400":"debug"===e.type?"text-yellow-400":"text-blue-400"}
            `,children:[a.jsx("span",{className:"text-gray-500",children:e.timestamp})," ",(0,a.jsxs)("span",{className:"text-gray-400",children:["[",e.type.toUpperCase(),"]"]})," ",e.message]}),e.details&&a.jsx("pre",{className:"ml-4 mt-1 text-gray-400 text-xs whitespace-pre-wrap",children:e.details})]},t)),0===e.length&&a.jsx("div",{className:"text-gray-500 italic",children:"等待操作..."})]})]})}function Home(){let[e,t]=(0,r.useState)("idle"),[s,n]=(0,r.useState)(null),[i,o]=(0,r.useState)(null),[l,c]=(0,r.useState)([]),addLog=(e,t="info",s)=>{let a=new Date().toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),r=`[${a}] [${t.toUpperCase()}] ${e}`;switch(t){case"error":console.error(r,s||"");break;case"success":console.log("%c"+r,"color: green",s||"");break;case"debug":console.debug(r,s||"");break;default:console.log(r,s||"")}c(r=>[...r,{timestamp:a,type:t,message:e,details:s}])},handleProcess=async(e,s)=>{try{let a;t("processing"),o(null),c([]),addLog("开始处理图片任务","info"),addLog("浏览器环境信息","debug",JSON.stringify({userAgent:navigator.userAgent,timestamp:new Date().toISOString(),screenSize:`${window.innerWidth}x${window.innerHeight}`,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,memory:performance?.memory?{jsHeapSizeLimit:(performance.memory.jsHeapSizeLimit/1024/1024).toFixed(2)+"MB",totalJSHeapSize:(performance.memory.totalJSHeapSize/1024/1024).toFixed(2)+"MB",usedJSHeapSize:(performance.memory.usedJSHeapSize/1024/1024).toFixed(2)+"MB"}:"Not available"},null,2)),addLog("图片详细信息","debug",JSON.stringify({image1:{name:e.name,size:`${(e.size/1024).toFixed(2)}KB`,type:e.type,lastModified:new Date(e.lastModified).toISOString(),dimensions:await getImageDimensions(e)},image2:{name:s.name,size:`${(s.size/1024).toFixed(2)}KB`,type:s.type,lastModified:new Date(s.lastModified).toISOString(),dimensions:await getImageDimensions(s)}},null,2));let r=new FormData;r.append("image1",e),r.append("image2",s),addLog("准备发送请求到服务器","info",JSON.stringify({endpoint:"/api/merge",method:"POST",contentType:"multipart/form-data",timestamp:new Date().toISOString()},null,2));let i=Date.now(),l="",d=await fetch("/api/merge",{method:"POST",body:r});a=Date.now();let g=a-i;addLog(`收到服务器初始响应，耗时: ${g}ms`,"info");let m=Object.fromEntries(d.headers.entries());addLog("服务器响应详情","debug",JSON.stringify({status:d.status,statusText:d.statusText,headers:m,type:d.type,url:d.url,redirected:d.redirected,ok:d.ok},null,2));try{l=await d.text(),addLog("服务器原始响应内容","debug",l);let e=JSON.parse(l);if(addLog("解析后的响应数据","debug",JSON.stringify(e,null,2)),!d.ok)throw Error(e.error||`服务器错误 (${d.status})`);addLog("图片处理成功","success"),e.resultUrl&&(addLog("生成的图片URL","info",e.resultUrl),addLog("处理完成时间","info",JSON.stringify({totalTime:`${Date.now()-i}ms`,serverProcessing:`${g}ms`,responseProcessing:`${Date.now()-a}ms`},null,2))),n(e.resultUrl),t("success")}catch(e){throw addLog("解析响应失败","error",JSON.stringify({error:e instanceof Error?e.message:String(e),responseText:l,contentType:m["content-type"],contentLength:m["content-length"]},null,2)),Error("无法解析服务器响应")}}catch(s){let e={message:s.message,stack:s.stack,timestamp:new Date().toISOString(),type:s.name,code:s.code,cause:s.cause?{message:s.cause.message,stack:s.cause.stack}:void 0,networkError:s instanceof TypeError&&s.message.includes("network"),parseError:s instanceof SyntaxError};addLog("处理失败","error",s.message),addLog("错误详细信息","debug",JSON.stringify(e,null,2)),o(s.message||"处理失败"),t("error")}},getImageDimensions=e=>new Promise(t=>{let s=new Image;s.onload=()=>{t({width:s.width,height:s.height})},s.src=URL.createObjectURL(e)});return a.jsx("main",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto py-12 px-4",children:[(0,a.jsxs)("h1",{className:"text-4xl font-bold text-center mb-8",children:["一起玩",a.jsx("span",{className:"inline-block px-2 py-1 mx-1 bg-blue-600 text-white rounded-lg transform hover:scale-105 transition-transform",children:"换脸"})]}),a.jsx(LogViewer,{logs:l,onClear:()=>c([])}),a.jsx(ImageUploader,{onProcess:handleProcess,status:e,onImageChange:()=>{n(null),o(null),t("idle"),c([])},onError:e=>{o(e),addLog(e,"error")}}),i&&a.jsx("div",{className:"mt-4 p-4 bg-red-100 text-red-700 rounded-lg",children:i}),s&&a.jsx(ResultDisplay,{imageUrl:s})]})})}},3982:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var a=s(5153);let r=(0,a.createProxy)(String.raw`D:\Cursor\face2exchange\app\page.tsx`),{__esModule:n,$$typeof:i}=r,o=r.default,l=o}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[472,837,55],()=>__webpack_exec__(1755));module.exports=s})();